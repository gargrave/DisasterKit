/* disaster_kit | built on 2015/9/12 */!function(){"use strict";angular.module("dk",["ngMessages","ui.router"]).config(["$interpolateProvider","$httpProvider","$stateProvider","$urlRouterProvider",function($interpolateProvider,$httpProvider,$stateProvider,$urlRouterProvider){$interpolateProvider.startSymbol("{A"),$interpolateProvider.endSymbol("A}"),$stateProvider.state("dk",{url:"","abstract":!0}).state("dk.item_list",{url:"/items/:forceUpdate",views:{"item_list@":{controller:"ItemListCtrl as itemListCtrl",templateUrl:"/static/app/items/list/item-list.html"}}}).state("dk.item_detail",{url:"/items/detail/:id",views:{"item_detail@":{controller:"ItemDetailCtrl as itemDetailCtrl",templateUrl:"/static/app/items/detail/item-detail.html"}}}).state("dk.item_create",{url:"/items/add/",views:{"item_create@":{controller:"ItemCreateCtrl as itemCreateCtrl",templateUrl:"/static/app/items/create/item-create.html"}}}).state("dk.item_update",{url:"/items/update/:id",views:{"item_update@":{controller:"ItemUpdateCtrl as itemUpdateCtrl",templateUrl:"/static/app/items/update/item-update.html"}}}),$urlRouterProvider.otherwise("/items/"),$httpProvider.defaults.xsrfCookieName="csrftoken",$httpProvider.defaults.xsrfHeaderName="X-CSRFToken",$httpProvider.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var param=function(obj){var name,value,fullSubName,subName,subValue,innerObj,i,query="";for(name in obj)if(value=obj[name],value instanceof Array)for(i=0;i<value.length;++i)subValue=value[i],fullSubName=name+"["+i+"]",innerObj={},innerObj[fullSubName]=subValue,query+=param(innerObj)+"&";else if(value instanceof Object)for(subName in value)subValue=value[subName],fullSubName=name+"["+subName+"]",innerObj={},innerObj[fullSubName]=subValue,query+=param(innerObj)+"&";else void 0!==value&&null!==value&&(query+=encodeURIComponent(name)+"="+encodeURIComponent(value)+"&");return query.length?query.substr(0,query.length-1):query};$httpProvider.defaults.transformRequest=[function(data){return angular.isObject(data)&&"[object File]"!==String(data)?param(data):data}]}])}(),function(){"use strict";angular.module("dk").controller("MainCtrl",[function(){var vm=this;vm["class"]={SIXCOLS:"six columns offset-by-three"}}])}(),function(){"use strict";angular.module("dk").controller("CategoryListCtrl",["$stateParams","categoryListSvc",function($stateParams,categoryListSvc){var vm=this;vm.loading=!0,vm.cats=[],vm.subcats=[],function(){categoryListSvc.getCategoryList().then(function(res){vm.cats=res.cats,vm.subcats=res.subcats,vm.loading=!1})}()}])}(),function(){"use strict";angular.module("dk").service("categoryListSvc",["$http","$q","$state",function($http,$q,$state){var vm=this,combined={};vm.getCategoryList=function(){var deferred=$q.defer();return combined.cats&&combined.subcats?deferred.resolve(combined):$http.get("items/api/get_categories").then(function(res){combined={cats:res.data.cats,subcats:res.data.subcats},deferred.resolve(combined)},function(res){alert("There was an error getting the categories list from the server.\nStatus code: "+res.status),$state.go("dk.home")}),deferred.promise}}])}(),function(){"use strict";angular.module("dk").directive("categoryRow",[function(){return{restrict:"A",scope:{cat:"="},templateUrl:"/static/app/categories/row/category-row.html"}}])}(),function(){"use strict";angular.module("dk").controller("ItemCreateCtrl",["$scope","$http","$state","categoryListSvc",function($scope,$http,$state,categoryListSvc){var vm=this;vm.loading=!0,vm.item={},vm.cats=[],vm.subcats=[],vm.load=function(){categoryListSvc.getCategoryList().then(function(res){vm.cats=res.cats,vm.subcats=res.subcats,vm.item.cat=vm.cats[0],vm.item.subcat=vm.subcats[0],vm.loading=!1})},vm.saveNewItem=function(){console.log("savenewItem()"),$scope.submitted=!1,$scope.createForm.$valid?(vm.item.notes=vm.item.notes||"",$http.post("items/api/create_item/",vm.item).then(function(res){$state.go("dk.item_list",{forceUpdate:!0})},function(res){alert("There was an error when attempting to create this items.\nStatus code: "+res.status),$state.go("dk.item_list")})):$scope.createForm.submitted=!0},function(){vm.load()}()}])}(),function(){"use strict";angular.module("dk").controller("ItemDetailCtrl",["$http","$state","$stateParams","itemListSvc",function($http,$state,$stateParams,itemListSvc){var vm=this;vm.loading=!0,vm.item={},vm.updateDetailedItem=function(){itemListSvc.getItemById($stateParams.id).then(function(res){vm.item=res,vm.loading=!1})},vm.deleteItem=function(){confirm("Delete this items?")&&$http["delete"]("items/api/delete_item/"+vm.item.id).then(function(res){$state.go("dk.item_list",{forceUpdate:!0})},function(res){alert("There was an error when attempting to delete this items.\nStatus code: "+res.status),$state.go("dk.item_list")})},function(){vm.updateDetailedItem()}()}])}(),function(){"use strict";angular.module("dk").directive("itemEntryForm",[function(){return{restrict:"A",scope:{ctrl:"=",form:"="},templateUrl:"/static/app/items/form/item-form.html"}}])}(),function(){"use strict";angular.module("dk").controller("ItemListCtrl",["$stateParams","itemListSvc",function($stateParams,itemListSvc){var vm=this,forceListUpdate=$stateParams.forceUpdate||!1;vm.loading=!0,vm.items=null,function(){itemListSvc.getItemList(forceListUpdate).then(function(res){vm.items=res,vm.loading=!1})}()}])}(),function(){"use strict";angular.module("dk").service("itemListSvc",["$http","$q","$state",function($http,$q,$state){var vm=this,items=[];vm.getItemList=function(forceUpdate){var deferred=$q.defer(),force=forceUpdate||!1;return items.length>0&&!force?deferred.resolve(items):$http.get("items/api/get_all_items").then(function(res){items=[];var jsonItems=res.data.items;for(var i in jsonItems)jsonItems.hasOwnProperty(i)&&items.push(jsonItems[i]);deferred.resolve(items)},function(res){alert("There was an error getting the items list from the server.\nStatus code: "+res.status),$state.go("dk.home")}),deferred.promise},vm.getItemById=function(targetID){var deferred=$q.defer();return $http.get("items/api/get_item_by_id/"+targetID).then(function(res){deferred.resolve(res.data)},function(res){"404"!=res.status&&alert("There was an error getting the items's details from the server.\nStatus code: "+res.status),$state.go("dk.item_list")}),deferred.promise}}])}(),function(){"use strict";angular.module("dk").directive("itemWidget",[function(){return{restrict:"A",scope:{itemData:"="},templateUrl:"/static/app/items/row/item-row.html"}}])}(),function(){"use strict";angular.module("dk").controller("ItemUpdateCtrl",["$scope","$http","$state","$stateParams","itemListSvc","categoryListSvc",function($scope,$http,$state,$stateParams,itemListSvc,categoryListSvc){function updateLoadingStatus(){vm.item.id&&vm.cats.length>0&&vm.subcats.length>0&&(vm.loading=!1)}var vm=this;vm.loading=!0,vm.item={},vm.cats=[],vm.subcats=[],vm.load=function(){itemListSvc.getItemById($stateParams.id).then(function(res){vm.item=res,updateLoadingStatus()}),categoryListSvc.getCategoryList().then(function(res){vm.cats=res.cats,vm.subcats=res.subcats,updateLoadingStatus()})},vm.commitUpdates=function(){$scope.submitted=!1,$scope.updateForm.$valid?$http.post("items/api/update_item/",vm.item).then(function(res){$state.go("dk.item_list",{forceUpdate:!0})},function(res){alert("There was an error when attempting to update this items.\nStatus code: "+res.status),$state.go("dk.item_list")}):$scope.updateForm.submitted=!0},function(){vm.load()}()}])}();